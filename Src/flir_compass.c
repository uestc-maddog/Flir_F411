/*-----------------------------------------------------------------
 * Name:      flir_compass.c
 * Purpose:   
 *-----------------------------------------------------------------
 * 
 * Copyright (c) *reserve
 
||                       _      _               ||
||    /\  /\  __  _  __ | | __ | | ____  ___ _  ||
||   /  \/  \/ _ ` |/ _ ` |/ _ ` |/ _  \/ _ ` | ||
||  / /\  /\  (_|    (_|    (_|    (_)   (_)  | ||
|| /_/  \/  \_.__, |\__, _|\__, _|\____/\___. | ||
|| =====================================|____/  ||
||                                              ||

 -----------------------------------------------------------------*/
 
/********************************************************************************************************
 *                                               INCLUDES
 ********************************************************************************************************/
/* System ralted */
#include "stm32f4xx_hal.h"
#include <string.h> 	
#include "stdint.h"
#include <stdbool.h>
#include <math.h>

/* Special requirement */
#include "flir_compass.h"
#include "flir_lcd.h"
#include "lepton.h"
//#include "font.h"  

/********************************************************************************************************
 *                                                 MACROS
 ********************************************************************************************************/

/********************************************************************************************************
 *                                               CONSTANTS
 ********************************************************************************************************/
const uint8_t Compass_Data[] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 48, 3, 240, 15, 0, 15, 128, 
1, 240, 0, 112, 7, 224, 14, 0, 15, 224, 0, 240, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0,
 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 15, 240, 0, 112, 1, 
192, 3, 0, 14, 0, 15, 240, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 
0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 15, 240, 9, 144, 9, 144, 9, 
144, 9, 144, 8, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 2, 0, 14, 224, 12, 176, 9, 144, 9, 176, 15, 48, 7, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255,
 0, 0, 0, 0, 0, 0, 48, 3, 240, 15, 0, 15, 128, 1, 240, 0, 112, 7, 224, 14, 0, 15, 224, 0, 240,
 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0,
 0, 0, 0, 15, 240, 0, 112, 1, 192, 3, 0, 14, 0, 15, 240, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 
0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 15, 240, 9, 
144, 9, 144, 9, 144, 9, 144, 8, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 
0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
 
/********************************************************************************************************
 *                                               GLOBAL VARIABLES
 ********************************************************************************************************/


/********************************************************************************************************
 *                                               EXTERNAL VARIABLES
 ********************************************************************************************************/

 
/********************************************************************************************************
 *                                               EXTERNAL FUNCTIONS
 ********************************************************************************************************/


/********************************************************************************************************
 *                                               LOCAL VARIABLES
 ********************************************************************************************************/

 
/********************************************************************************************************
 *                                               LOCAL FUNCTIONS
 ********************************************************************************************************/

 
/********************************************************************************************************
 *                                               PUBLIC FUNCTIONS
 ********************************************************************************************************/
/*********************************************************************
 * @fn      Show_focusing
 *
 * @brief   show focusing lines
 *
 * @param   none
 *
 * @return  
 */
void Add_compass(uint16_t Compass_Angle)
{
	int i = 0, j = 0;
	uint8_t temp = 0;
	uint8_t Compass_Offset = (uint8_t)(Compass_Angle * 220 / 360);
	
	for(i = 0; i < FLIR_LCD_RAW; i++)            // 行切换
	{
		for(j = 0; j < 8; j++)                     // 前八列
		{
				temp = Compass_Data[(i+Compass_Offset)*2] << j;
				rowBuf[i][j] = (temp & 0x80)?(~rowBuf[i][j]):rowBuf[i][j];
//				if(temp & 0x80) rowBuf[i][j] = ~rowBuf[i][j];  //0x0ffff;
//				else            rowBuf[i][j] = rowBuf[i][j];					
		}
		for(j = 8; j < Compass_COLUMNUM; j++)      // 后八列
		{
				temp = Compass_Data[(i+Compass_Offset)*2+1] << (j-8);
				rowBuf[i][j] = (temp & 0x80)?(~rowBuf[i][j]):rowBuf[i][j];
//				if(temp & 0x80) rowBuf[i][j] = ~rowBuf[i][j];  //0x0ffff;
//				else            rowBuf[i][j] = rowBuf[i][j];
		}
	}
}
 

 /********************************************************************************************************
 *                                               LOCAL FUNCTIONS
 ********************************************************************************************************/


/*********************************************************************
 */
